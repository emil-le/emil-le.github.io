<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Statistical shape matching | Geometry and topology statistical inference with applications.</title>
  <meta name="description" content="Capstone Project." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Statistical shape matching | Geometry and topology statistical inference with applications." />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Capstone Project." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Statistical shape matching | Geometry and topology statistical inference with applications." />
  
  <meta name="twitter:description" content="Capstone Project." />
  

<meta name="author" content="Emil Le" />


<meta name="date" content="2021-03-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistics-on-riemannian-manifold.html"/>
<link rel="next" href="persistence-homology.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="0.1" data-path="preface.html"><a href="preface.html#homeomorphism"><i class="fa fa-check"></i><b>0.1</b> Homeomorphism</a></li>
<li class="chapter" data-level="0.2" data-path="preface.html"><a href="preface.html#differential-manifold"><i class="fa fa-check"></i><b>0.2</b> Differential Manifold</a></li>
<li class="chapter" data-level="0.3" data-path="preface.html"><a href="preface.html#probability-measure"><i class="fa fa-check"></i><b>0.3</b> Probability measure</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="statistics-on-riemannian-manifold.html"><a href="statistics-on-riemannian-manifold.html"><i class="fa fa-check"></i><b>1</b> Statistics on Riemannian Manifold</a>
<ul>
<li class="chapter" data-level="1.1" data-path="statistics-on-riemannian-manifold.html"><a href="statistics-on-riemannian-manifold.html#riemannian-manifold"><i class="fa fa-check"></i><b>1.1</b> Riemannian Manifold</a></li>
<li class="chapter" data-level="1.2" data-path="statistics-on-riemannian-manifold.html"><a href="statistics-on-riemannian-manifold.html#instrinsic-mean-and-variance"><i class="fa fa-check"></i><b>1.2</b> Instrinsic mean and variance:</a></li>
<li class="chapter" data-level="1.3" data-path="statistics-on-riemannian-manifold.html"><a href="statistics-on-riemannian-manifold.html#sample-fréchet-mean-and-variance"><i class="fa fa-check"></i><b>1.3</b> Sample Fréchet mean and variance:</a></li>
<li class="chapter" data-level="1.4" data-path="statistics-on-riemannian-manifold.html"><a href="statistics-on-riemannian-manifold.html#sample-fréchet-mean"><i class="fa fa-check"></i><b>1.4</b> Sample Fréchet mean</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="statistical-shape-matching.html"><a href="statistical-shape-matching.html"><i class="fa fa-check"></i><b>2</b> Statistical shape matching</a>
<ul>
<li class="chapter" data-level="2.1" data-path="statistical-shape-matching.html"><a href="statistical-shape-matching.html#intrinsic-data-analysis"><i class="fa fa-check"></i><b>2.1</b> Intrinsic data analysis</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="statistical-shape-matching.html"><a href="statistical-shape-matching.html#fréchet-mean-and-variance"><i class="fa fa-check"></i><b>2.1.1</b> Fréchet mean and variance</a></li>
<li class="chapter" data-level="2.1.2" data-path="statistical-shape-matching.html"><a href="statistical-shape-matching.html#geodesics-and-arc-distance"><i class="fa fa-check"></i><b>2.1.2</b> Geodesics and arc distance</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="statistical-shape-matching.html"><a href="statistical-shape-matching.html#central-limit-theorem"><i class="fa fa-check"></i><b>2.2</b> Central Limit Theorem</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="statistical-shape-matching.html"><a href="statistical-shape-matching.html#sample-estimator-for-frechet-mean"><i class="fa fa-check"></i><b>2.2.1</b> Sample Estimator for Frechet mean:</a></li>
<li class="chapter" data-level="2.2.2" data-path="statistical-shape-matching.html"><a href="statistical-shape-matching.html#sample-estimator-for-frechet-variance"><i class="fa fa-check"></i><b>2.2.2</b> Sample Estimator for Frechet variance:</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="statistical-shape-matching.html"><a href="statistical-shape-matching.html#geodesics-regression"><i class="fa fa-check"></i><b>2.3</b> Geodesics Regression</a></li>
<li class="chapter" data-level="2.4" data-path="statistical-shape-matching.html"><a href="statistical-shape-matching.html#isomorphic-embedding"><i class="fa fa-check"></i><b>2.4</b> Isomorphic embedding</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="persistence-homology.html"><a href="persistence-homology.html"><i class="fa fa-check"></i><b>3</b> Persistence Homology</a>
<ul>
<li class="chapter" data-level="3.1" data-path="persistence-homology.html"><a href="persistence-homology.html#vietorisrips-complex"><i class="fa fa-check"></i><b>3.1</b> Vietoris–Rips complex</a></li>
<li class="chapter" data-level="3.2" data-path="persistence-homology.html"><a href="persistence-homology.html#persistent-diagram"><i class="fa fa-check"></i><b>3.2</b> Persistent Diagram</a></li>
<li class="chapter" data-level="3.3" data-path="persistence-homology.html"><a href="persistence-homology.html#filtrations"><i class="fa fa-check"></i><b>3.3</b> Filtrations</a></li>
<li class="chapter" data-level="3.4" data-path="persistence-homology.html"><a href="persistence-homology.html#reeb-graph-inference"><i class="fa fa-check"></i><b>3.4</b> Reeb Graph inference</a></li>
<li class="chapter" data-level="3.5" data-path="persistence-homology.html"><a href="persistence-homology.html#confidence-set"><i class="fa fa-check"></i><b>3.5</b> Confidence Set</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="application.html"><a href="application.html"><i class="fa fa-check"></i><b>4</b> Application</a>
<ul>
<li class="chapter" data-level="4.1" data-path="application.html"><a href="application.html#gene-expression"><i class="fa fa-check"></i><b>4.1</b> Gene Expression</a></li>
<li class="chapter" data-level="4.2" data-path="application.html"><a href="application.html#generative-model-for-gene-co-expression-network"><i class="fa fa-check"></i><b>4.2</b> Generative model for gene co-expression network</a></li>
<li class="chapter" data-level="4.3" data-path="application.html"><a href="application.html#data-collection-and-pre-processing"><i class="fa fa-check"></i><b>4.3</b> Data Collection and Pre-processing</a></li>
<li class="chapter" data-level="4.4" data-path="application.html"><a href="application.html#network-visualization"><i class="fa fa-check"></i><b>4.4</b> Network Visualization</a></li>
<li class="chapter" data-level="4.5" data-path="application.html"><a href="application.html#heavy-tailed-distribution-analysis"><i class="fa fa-check"></i><b>4.5</b> Heavy tailed distribution analysis</a></li>
<li class="chapter" data-level="4.6" data-path="application.html"><a href="application.html#betti-number-inference"><i class="fa fa-check"></i><b>4.6</b> Betti Number Inference</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="random.html"><a href="random.html"><i class="fa fa-check"></i><b>5</b> random</a></li>
<li class="chapter" data-level="6" data-path="code-need-to-fix.html"><a href="code-need-to-fix.html"><i class="fa fa-check"></i><b>6</b> code need to fix</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Geometry and topology statistical inference with applications.</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="statistical-shape-matching" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Statistical shape matching</h1>
<div id="intrinsic-data-analysis" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Intrinsic data analysis</h2>
<div id="fréchet-mean-and-variance" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Fréchet mean and variance</h3>
<p>Since a <span class="math inline">\(\mathcal{M}\)</span>-random variable (r.v) <span class="math inline">\(\mathcal{X}:(\Omega,\mathcal{F},\mathbb{P})\to\mathcal{B}_{\mathcal{M}}\)</span> is measurable, assign every <span class="math inline">\(\mathcal{X}\)</span> with measure <span class="math inline">\(Q = \mathbb{P}_{\mathcal{X}}(\mathcal{X})\)</span> on <span class="math inline">\(\mathcal{B}_{\mathcal{M}}\)</span> generated by <span class="math inline">\(Q(B)=\mathbb{P}(\mathcal{X}^{-1}({B}))\)</span> for any arbitrary <span class="math inline">\(B\in\mathcal{B}_{\mathcal{B}}\)</span>. Recall that on Riemannian manifold, there exists <span class="math inline">\(\phi_p: \mathcal{M}\to\mathbb{R}^n\)</span> contained in <span class="math inline">\(\mathcal{L}_{Q}^r(\mathcal{M})\)</span> and an embedding <span class="math inline">\(p:\mathcal{M}\to\mathbb{R}^n\)</span> such that
<span class="math display">\[\phi_p(u,v)=\|p(v)-p(u)\|_2\]</span>
: The Fréchet function <span class="math inline">\(\mathcal{F}(v):\mathcal{M}\to\mathbb{R}^n\)</span> is defined as <span class="math display">\[\mathcal{F}(p)=\int \rho^2(p,x)\mathcal{Q}(dx)\]</span> is defined as the Fréchet function. Then the Fréchet mean and variance are define as
<span class="math display">\[\mu_{F} = \arg\inf_\mu \mathbb{E}_{\mathcal{X}}[\phi^2(\mathcal{X},\mu)]\]</span>
<span class="math display">\[\sigma^2_{F}= \inf_{\mu} \mathbb{E}_{\mathcal{X}}[d^2(\mathcal{X},\mu)]\]</span>
Furthermore, <span class="math inline">\(\mu_{F}\)</span> and <span class="math inline">\(\sigma^2_{F}\)</span> is also referred as an intrinsic mean and variance, which can be understand as an attempt to make analogy to the usual standard probability space. In fact, in <span class="math inline">\(\mathbb{R}_{std}\)</span>, the intrinsic mean is the expectation of r.v <span class="math inline">\(X\)</span>. Intuitively, this may suggest an extrinsic mean (which it is indeed true).</p>

<div class="lemma">
<span id="lem:unnamed-chunk-2" class="lemma"><strong>Lemma 2.1  </strong></span>If the curvature <span class="math inline">\((\mathcal{M},\phi)\)</span> is non-positive and there exists a <span class="math inline">\(v\in \mathcal{M}\)</span> such that <span class="math inline">\(\mathcal{F}(v)\)</span> is finite, then every measure <span class="math inline">\(Q\)</span> has an intrinsic mean.
</div>
</div>
<div id="geodesics-and-arc-distance" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Geodesics and arc distance</h3>

<div class="definition">
<p><span id="def:unnamed-chunk-3" class="definition"><strong>Definition 2.1  </strong></span>Let <span class="math inline">\(p \in \mathcal{M}\)</span> be arbitray. Consider an open ball <span class="math inline">\(B_{\epsilon &gt;0}\subseteq T_p\mathcal{M}\)</span> of <span class="math inline">\(0\)</span>, there exists an unique geodesics <span class="math inline">\(\gamma(t)\)</span> and an exponential map such that:
<span class="math display">\[
\begin{aligned}
  \text{Exp}_{p}: B_{\epsilon}^n &amp;\longrightarrow \mathcal{M}   \\
  \mathbf{v}&amp;\longmapsto \gamma_{v}(t) \text{ s.t. } \begin{cases}
0\in B_{\epsilon}^n\subseteq T_p\mathcal{M}\\
\gamma(0) = p\\
\dot\gamma(0) = \mathbf{v}\\
\end{cases}\\
\end{aligned}
\]</span></p>
</div>

<div class="definition">
<span id="def:unnamed-chunk-4" class="definition"><strong>Definition 2.2  </strong></span>Given any arbitrary <span class="math inline">\(x_1,x_2 \in \mathcal{M}\)</span>, the Rienmann distance between <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> is defined by the minimum length of all geodesics connecting them:
<span class="math display">\[L = \inf \int_{0}^{t}\gamma(t) dt\]</span>
</div>
</div>
</div>
<div id="central-limit-theorem" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Central Limit Theorem</h2>
<div id="sample-estimator-for-frechet-mean" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Sample Estimator for Frechet mean:</h3>

<div class="definition">
<span id="def:unnamed-chunk-5" class="definition"><strong>Definition 2.3  </strong></span>Let <span class="math inline">\(\mathcal{X}_1,\mathcal{X}_2,\dots,\mathcal{X}_n\)</span> be iid r.v. of the same distribution <span class="math inline">\(Q\)</span> on the same metric space (<span class="math inline">\(\mathcal{M}\)</span>,<span class="math inline">\(\phi\)</span>). Let the emperical joint distribution be <span class="math inline">\(\hat{Q}_n = \frac{1}{n}\sum_{i=1}^n\partial_{\mathcal{X}_k}\)</span>, then Frechet sample mean is the Frechet mean of <span class="math inline">\(\hat{Q}_n\)</span>:
<span class="math display">\[\hat{\Mu}_F = \{\hat{p}\vert\hat{p} = \arg\min_{p}\frac{1}{n}\sum_{i=1}^n d^2(\mathcal{X}_i,p)\}\]</span>
</div>

<div class="theorem">
<span id="thm:unnamed-chunk-6" class="theorem"><strong>Theorem 2.1  </strong></span>Let <span class="math inline">\(Q\)</span> be measure on the metric space (<span class="math inline">\(\mathcal{M}\)</span>,<span class="math inline">\(\phi\)</span>) such that any arbitrary closed and bounded set is also compact in <span class="math inline">\(\mathcal{M}\)</span>, and the event collection <span class="math inline">\(\mathcal{F}\)</span> is finite:
  1) Any arbitrary open ball <span class="math inline">\(B_{\epsilon&gt;0}\)</span> of Frechet means <span class="math inline">\(\Mu_F\)</span>contains at least a <span class="math inline">\(P\)</span>-null set <span class="math inline">\(N\)</span> s.t. <span class="math inline">\(n(\delta) &lt; \infty(\forall\delta\in N^c)\)</span> whenenver <span class="math inline">\(n \geq n(\delta)\)</span>.
  2) If there exists a Frechet mean of <span class="math inline">\(Q\)</span> then Frechet mean <span class="math inline">\(\hat{\Mu}_{F}\)</span> of <span class="math inline">\(\hat{Q}_n\)</span> is a consistent estimator for <span class="math inline">\(\Mu_F\)</span> of <span class="math inline">\(Q\)</span>
</div>
<p>Proof:
Let <span class="math inline">\(Q\)</span> be measure with finite <span class="math inline">\(\mathcal{F}\)</span> on the metric space (<span class="math inline">\(\mathcal{M}\)</span>,<span class="math inline">\(\phi\)</span>) such that any arbitrary closed and bounded set is also compact in <span class="math inline">\(\mathcal{M}\)</span>. It is possible to pick arbitrary closed and bounded subset <span class="math inline">\(\mathcal{C}\)</span> under metric space of <span class="math inline">\(\mathcal{M}\)</span>. By definition, <span class="math inline">\(\mathcal{C}\)</span> is compact.</p>
</div>
<div id="sample-estimator-for-frechet-variance" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Sample Estimator for Frechet variance:</h3>
</div>
</div>
<div id="geodesics-regression" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Geodesics Regression</h2>
<pre><code>X = main_closed(path)
qarray = list()
for (i in 1:length(X)) {
  qarray[[i]] = curve_to_q(X[[i]])
}
All_mean_shape = find_mean_shape(qarray)
saveRDS(All_mean_shape, file = &quot;All_mean_shape.rds&quot;)
qmean = All_mean_shape[[1]]
qmean_new = project_curve(qmean)
pmean = q_to_curve(qmean_new)
plot_curve(pmean,&#39;r&#39;,filename = &#39;Mean Shape&#39;)</code></pre>
<pre><code>plot_pca_variation(alpha_t_array, qmean, eigdir = 1,qarray, dt = 0)
deformation_field_all(alpha_t_array, pmean, qmean, X)</code></pre>
</div>
<div id="isomorphic-embedding" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Isomorphic embedding</h2>
<pre><code>FPS = function(S, N, first_idx = &#39;a&#39;) {
  nv = length(S$X)
  if (first_idx == &#39;a&#39;) {
      first_idx = randi(nv)
  }
  
  sample = matrix(0, N, 1)
  
  D = matrix(0, N, nv)
  
  for (i in seq(N)) {
      if (i == 1) {
          idx = first_idx
      }
      else if (i == 2) {
          idx= apply(D[1, ],2,max)
      }
      else {
          idx= apply(apply(D[1:i-1, ],2,min),2,max)
      }
      
      sample(i) = idx
      src = matrix(Inf, nv, 1)
      src(idx) = 0;
      
      D[i,] = fastmarch(S$TRIV, S$X, S$Y, S$Z, src, &#39;single&#39;)
  }
  
  return(List(&#39;D_ext&#39; = D,&#39;sample&#39;=sample))
}

initialize_C_sliding_window = function(X1, X2, corr_1, corr_2) {
  num_pt = length(corr_1)
  S = num_pt*4
  rot_slide = cell(S,1)
  
  for (i in seq(S)) {
    Y1 = X1[corr_1,i:num_pt+i-1];
    Y2 = X2[corr_2,i:num_pt+i-1];
    temp = svd(t(Y1)%*%Y2,0)
    U = temp$u
    V = temp$v
    rot_slide{i} = U%*%t(V)
  }
  
  rot_curr = matrix(0,S+num_pt-1)
  rot_W = rot_curr
  
  for (i in seq(S)) {
    rot_W_mat = matrix(0,num_pt);
    sot_slide_mat = matrix(0,num_pt); 
    
    if (i == 1) {
        rot_W_mat[1:end-1, 1:end-1] = 1
        sot_slide_mat[1:end-1, 1:end-1] = rot_slide{i}(1:end-1, 1:end-1)
    } else {                
        rot_W_mat[2:end-1, 2:end-1] = 1
        sot_slide_mat[2:end-1, 2:end-1] = rot_slide{i}(2:end-1, 2:end-1)
    }

    rot_W[i:i+num_pt-1,i:i+num_pt-1] = rot_W[i:i+num_pt-1,i:i+num_pt-1] + rot_W_mat
    rot_curr[i:i+num_pt-1,i:i+num_pt-1] = rot_curr[i:i+num_pt-1,i:i+num_pt-1] + sot_slide_mat
  }
  rot_initial_final_rec = solve(rot_curr,rot_W)
  rot_initial_final_rec[rot_curr == 0] = 0
  
  rot_initial_final_rec = rot_initial_final_rec[1:end-1, 1:end-1]
  temp = svd(rot_initial_final_rec,0)
  U = temp$u
  V = temp$v
  rot_initial_final_rec = U%*%t(V)
  C = rot_initial_final_rec
  
  return(C)
}</code></pre>
<pre><code>ICP_refine = function(X1, X2, corr_initial, ITER=20, use_ann=FALSE) {
  corr = corr_initial;
  for (i in seq(ITER)) {
    temp = svd(t(X1[corr,])%*%X2,0)
    U = temp$u
    V = temp$v
    C = U%*%t(V)
    Y1 = X1%*%C
    if (use_ann) {
      corr = annquery(t(Y1),t(X2),1)
    } else {
      corr = get.knnx(Y1,X2)
    }
  }
  return(list(&#39;corr_refined&#39; = corr,&#39;C&#39; = C))
}
</code></pre>
<pre><code>FastGeodesics = function(R, sample2){
  N = length(sample2);
  N1 = round(0.5*N);
  U = rat(sample2)
  res = eigs((U+t(U))/2,N1,which = &quot;LM&quot;)
  V = res$values
  D = res$vectors
  d = diag(D)
  S = R
  d1 = solve(diag(1),d)
  D1 = diag(d1)
  I = V%*%D1%*%t(V)
  return(list(&#39;S&#39; = S,&#39;I&#39; = I))
}

GeodesicsBasis = function(S, I){
  decomp = qr.solve(S,0)
  W = decomp$Q %*% I %*% t(decomp$R)
  res = eigen((W + t(W))/2)
  Q = decomp$Q %*% res$values
  beta = res$vectors
  return(list(&#39;Q&#39; = Q, &#39;beta&#39; = beta))
}

shape_match = function(N = 100, rand = 1000, ITER = 5) {
  nv_1 = length(surface_1$X);
  nv_2 = length(surface_2$X);
  
  corr_true = t(randperm(nv_2,nv_2))
  corr_true_reverse[corr_true,1] = seq(nv_2);
  
  surface_2$X = surface_2$X[corr_true]; 
  surface_2$Y = surface_2$Y[corr_true]; 
  surface_2$Z = surface_2$Z[corr_true];
  
  surface_2$TRIV = corr_true_reverse(surface_2$TRIV);
  
  first_idx = FPS(surface_1, 1)
  tempr = FPS(surface_1, N, first_idx)
  D_ext = tempr$D_ext
  sample_1 = tempr$sample
  R_1 = t(D_ext)  
  
  first_idx = FPS(surface_2, 1)
  tempr = FPS(surface_2, N, first_idx)
  D_ext = tempr$D_ext
  sample_2 = tempr$sample 
  R_2 = t(D_ext)   
  
  tempr = FastGeodesics(R_1, sample_1)
  S_1 = tempr$S
  T_1 = tempr$I 
    
  tempr = FastGeodesics(R_2, sample_2)
  S_2 = tempr$S
  T_2 = tempr$I 
  
  tempr = GeodesicsBasis(S_1, T_1)
  Q_1 = tempr$S 
  beta_1=tempr$I 
  
  tempr = GeodesicsBasis(S_2, T_2)
  Q_2 = tempr$S 
  beta_2=tempr$I 
  

  X1 = Q_1%*%sqrt(beta_1)
  X2 = Q_2%*%sqrt(beta_2)
  
  landmarks_num = 5;
  corr_2_5pt = sample_2[1:landmarks_num]
  corr_1_5pt = corr_true[corr_2_5pt]
  C_init = initialize_C_sliding_window(X1, X2, corr_1_5pt, corr_2_5pt)

  sample_rand = randperm(nv_2, rand_num)
  C_refined = ICP_refine_C(X1, X2[sample_rand,], C_init, ITER, use_ann)$C

  Y1 = X1%*%C_refined
  Y2 = X2[sample_rand,]
  corr_sample_rand = get.knnx(cbind(Re(Y1),Im(Y1)),cbind(Re(Y2),Im(Y2)))
  
  perimeter = 0
  num_test = pmin(length(sample_rand), 500)
  err_gdd =  matrix(0,num_test,1)
  
  len = seq(1,num_test)
  
  for (i in len) {
      idx = corr_true[sample_rand[i]];
      
      src = matrix(0,Inf,1)
      src(idx) = 0
      d = fastmarch(surface_1$TRIV, surface_1$X, surface_1$Y, surface_1$Z, src, &#39;single&#39;)
      
      perimeter = apply(perimeter, apply(d,2,max),2,max)
      err_gdd[i] = d[corr_sample_rand[i]]
  }
  
  err_gdd = err_gdd/perimeter
  err_sort = sort(err_gdd)
  
  corr_full = annquery(t(cbind(Re(Y1),Im(Y1))),t(cbind(Re(X2),Im(X2))), 1)
  color = d

  c(surface_1$TRIV, surface_1$X, surface_1$Y, surface_1$Z,color)
  c(surface_2.TRIV, surface_2$X+60, surface_2$Y+60, surface_2$Z+60,corr_full)
}
</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistics-on-riemannian-manifold.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="persistence-homology.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-geodesicregression.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
